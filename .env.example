# ess-accu-off Konfiguration
# Diese Datei kann entweder:
#  - als ".env" im Repo/Script-Ordner liegen (wird automatisch geladen), oder
#  - als "/etc/victron-ess.env" via systemd "EnvironmentFile=" genutzt werden.

# Optional: expliziter Pfad zur Env-Datei (wenn du das Script manuell startest)
# ESS_ACCU_OFF_ENV_FILE=/etc/victron-ess.env

# -------------------------
# Modbus TCP
# -------------------------
VENUS_IP=192.168.41.101
VENUS_PORT=502
MODBUS_TIMEOUT_S=2

# -------------------------
# Enable-Switch (Script arbeitet nur wenn Enable==1)
# -------------------------
READ_UNIT_ID=100
REG_ENABLE=806

# -------------------------
# Messwerte (Unit READ_UNIT_ID)
# -------------------------
REG_SOC=843
REG_LOAD_BASE=817          # 3 Register: 817/818/819 (Summe)
PV_REGS=811,812,813        # PV Register (Summe)

# -------------------------
# MultiPlus Mode (Unit MODE_UNIT_ID)
# -------------------------
MODE_UNIT_ID=227
REG_MODE=33

# -------------------------
# ESS Mode (Hub4Mode)
# -------------------------
ESS_UNIT_ID=100
REG_ESS_MODE=2902
ESS_DAY_VALUE=1            # ESS1 (mit Phase Compensation)
ESS_NIGHT_VALUE=2          # ESS2 (ohne Phase Compensation)

# WICHTIG:
# ESS2 macht i.d.R. nur bei 3-phasigen Systemen Sinn.
# Wenn dein System 1-phasig ist: auf 0 lassen (kein Umschalten in der Nacht).
ESS_ALLOW_NIGHT_SWITCH=0

# -------------------------
# SOC Logik
# -------------------------
SOC_MIN=39
SOC_CHARGE_MIN=50

# -------------------------
# PV Ãœberschuss Erkennung
# -------------------------
PV_SURPLUS_W=100
PV_SURPLUS_CONFIRM_S=60

# -------------------------
# Nacht-Erkennung (Integrator)
# -------------------------
PV_NIGHT_W=200
NIGHT_CONFIRM_S=1800
NIGHT_DECAY_FACTOR=0.25

# Nachtregel: wenn SOC < SOC_CHARGE_MIN und Nacht erkannt ist -> OFF bleiben
TURN_OFF_AT_NIGHT_WHEN_BELOW_CHARGE_MIN=1

# Abschalt-Sequenz: erst ChargerOnly, dann warten, dann Off
OFF_DELAY_SECONDS=30

# Loop / Schutz
POLL_INTERVAL_S=5.0
MIN_WRITE_GAP_S=5.0
MIN_ESS_WRITE_GAP_S=30.0

# Skalierung/Offsets
SOC_DIVISOR=1
ADDR_OFFSET=0

# Sicherheit: keine Writes (nur Logging)
DRY_RUN=0
